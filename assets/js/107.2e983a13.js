(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{709:function(e,a,t){"use strict";t.r(a);var o=t(0),s=Object(o.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"store-field-keep-an-up-to-date-game-deadline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#store-field-keep-an-up-to-date-game-deadline"}},[e._v("#")]),e._v(" Store Field - Keep an Up-To-Date Game Deadline")]),e._v(" "),t("HighlightBox",{attrs:{type:"synopsis"}},[t("p",[e._v("Make sure you have all you need before proceeding:")]),e._v(" "),t("ul",[t("li",[e._v("You understand the concepts of "),t("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("Protobuf")]),e._v(".")],1),e._v(" "),t("li",[e._v("Have Go installed.")]),e._v(" "),t("li",[e._v("The checkers blockchain codebase with the game FIFO. You can get there by following the "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[e._v("previous steps")]),e._v(" or checking out the "),t("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/game-fifo",target:"_blank",rel:"noopener noreferrer"}},[e._v("relevant version"),t("OutboundLink")],1),e._v(".")],1)])]),e._v(" "),t("p",[e._v("In the "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[e._v("previous section")]),e._v(" you introduced a FIFO that keeps the "),t("em",[e._v("oldest")]),e._v(" games at its head and the most recently updated games at its tail.")],1),e._v(" "),t("p",[e._v("Just because a game has not been updated in a while does not mean that it has expired. To ascertain this you need to add a new field, "),t("code",[e._v("deadline")]),e._v(", to a game and test against it. Time to prepare the field.")]),e._v(" "),t("h2",{attrs:{id:"new-information"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[e._v("#")]),e._v(" New information")]),e._v(" "),t("p",[e._v("To prepare the field, add in the "),t("code",[e._v("StoredGame")]),e._v("'s Protobuf definition:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"bWVzc2FnZSBTdG9yZWRHYW1lIHsKICAgIC4uLgogICAgc3RyaW5nIGRlYWRsaW5lID0gMTA7Cn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/proto/checkers/stored_game.proto#L18"}}),e._v(" "),t("p",[e._v("To have Ignite CLI and Protobuf recompile this file. You can use:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgZ2VuZXJhdGUgcHJvdG8tZ28K"}}),e._v(" "),t("p",[e._v("On each update the deadline will always be "),t("em",[e._v("now")]),e._v(" plus a fixed duration. In this context, "),t("em",[e._v("now")]),e._v(" refers to the block's time. Declare this duration as a new constant, along with how the date is to be represented, i.e. encoded in the saved game as a string:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Y29uc3QgKAogICAgTWF4VHVybkR1cmF0aW9uSW5TZWNvbmRzID0gdGltZS5EdXJhdGlvbigyNCAqIDNfNjAwICogMTAwMF8wMDBfMDAwKSAvLyAxIGRheQogICAgRGVhZGxpbmVMYXlvdXQgICAgICAgICAgID0gJnF1b3Q7MjAwNi0wMS0wMiAxNTowNDowNS45OTk5OTk5OTkgKzAwMDAgVVRDJnF1b3Q7CikK",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/keys.go#L38-L39"}}),e._v(" "),t("h2",{attrs:{id:"date-manipulation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#date-manipulation"}},[e._v("#")]),e._v(" Date manipulation")]),e._v(" "),t("p",[e._v("You can make your life easier by using helper functions that encode and decode the deadline in the storage.")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("First define a new error:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"RXJySW52YWxpZERlYWRsaW5lID0gc2RrZXJyb3JzLlJlZ2lzdGVyKE1vZHVsZU5hbWUsIDExMTAsICZxdW90O2RlYWRsaW5lIGNhbm5vdCBiZSBwYXJzZWQ6ICVzJnF1b3Q7KQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/errors.go#L21"}})],1),e._v(" "),t("li",[t("p",[e._v("Now you can add your date helpers. A reasonable location to pick is "),t("code",[e._v("full_game.go")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoc3RvcmVkR2FtZSAqU3RvcmVkR2FtZSkgR2V0RGVhZGxpbmVBc1RpbWUoKSAoZGVhZGxpbmUgdGltZS5UaW1lLCBlcnIgZXJyb3IpIHsKICAgIGRlYWRsaW5lLCBlcnJEZWFkbGluZSA6PSB0aW1lLlBhcnNlKERlYWRsaW5lTGF5b3V0LCBzdG9yZWRHYW1lLkRlYWRsaW5lKQogICAgcmV0dXJuIGRlYWRsaW5lLCBzZGtlcnJvcnMuV3JhcGYoZXJyRGVhZGxpbmUsIEVyckludmFsaWREZWFkbGluZS5FcnJvcigpLCBzdG9yZWRHYW1lLkRlYWRsaW5lKQp9CgpmdW5jIEZvcm1hdERlYWRsaW5lKGRlYWRsaW5lIHRpbWUuVGltZSkgc3RyaW5nIHsKICAgIHJldHVybiBkZWFkbGluZS5VVEMoKS5Gb3JtYXQoRGVhZGxpbmVMYXlvdXQpCn0K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/full_game.go#L37-L48"}}),e._v(" "),t("p",[e._v("Of note in the above is that "),t("code",[e._v("sdkerrors.Wrapf(err, ...)")]),e._v(" returns "),t("code",[e._v("nil")]),e._v(" if "),t("code",[e._v("err")]),e._v(" is "),t("code",[e._v("nil")]),e._v(". This is very convenient.")])],1),e._v(" "),t("li",[t("p",[e._v("Add a function that encapsulates the knowledge of how the next deadline is calculated in the same file:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBHZXROZXh0RGVhZGxpbmUoY3R4IHNkay5Db250ZXh0KSB0aW1lLlRpbWUgewogICAgcmV0dXJuIGN0eC5CbG9ja1RpbWUoKS5BZGQoTWF4VHVybkR1cmF0aW9uSW5TZWNvbmRzKQp9Cg==",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/full_game.go#L42-L44"}})],1)]),e._v(" "),t("h2",{attrs:{id:"updated-deadline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#updated-deadline"}},[e._v("#")]),e._v(" Updated deadline")]),e._v(" "),t("p",[e._v("Next you need to update this new field with its appropriate value:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("At creation in the message handler for game creation:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Li4uCnN0b3JlZEdhbWUgOj0gdHlwZXMuU3RvcmVkR2FtZXsKICAgIC4uLgogICAgRGVhZGxpbmU6IHR5cGVzLkZvcm1hdERlYWRsaW5lKHR5cGVzLkdldE5leHREZWFkbGluZShjdHgpKSwKfQo=",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/keeper/msg_server_create_game.go#L26"}})],1),e._v(" "),t("li",[t("p",[e._v("And after a move in the message handler:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Li4uCnN0b3JlZEdhbWUuTW92ZUNvdW50KysKc3RvcmVkR2FtZS5EZWFkbGluZSA9IHR5cGVzLkZvcm1hdERlYWRsaW5lKHR5cGVzLkdldE5leHREZWFkbGluZShjdHgpKQouLi4K",url:"https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/keeper/msg_server_play_move.go#L56"}})],1)]),e._v(" "),t("p",[e._v("Now confirm that your project still compiles:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"sh",base64:"JCBpZ25pdGUgY2hhaW4gYnVpbGQK"}}),e._v(" "),t("h2",{attrs:{id:"next-up"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),t("p",[e._v("You have created and updated the deadline. The "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-forfeit.html"}},[e._v("section two steps ahead")]),e._v(" describes how to use the deadline and "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[e._v("the FIFO")]),e._v(" to expire games that reached their deadline.")],1),e._v(" "),t("p",[e._v("Before you can do that there is one other field you need to add. Discover which in the "),t("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-winner.html"}},[e._v("next section")]),e._v(".")],1)],1)}),[],!1,null,null,null);a.default=s.exports}}]);